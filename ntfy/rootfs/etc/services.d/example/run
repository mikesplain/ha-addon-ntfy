#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start the example service
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

# Add your code here

# Declare variables
declare message

## Get the 'message' key from the user config options.
message=$(bashio::config 'message')

## Print the message the user supplied, defaults to "Hello World..."
# bashio::log.info "${message:="Hello World..."}"

if bashio::config.true 'ssl'; then
  certfile=$(bashio::config 'certfile')
  keyfile=$(bashio::config 'keyfile')

  export NTFY_LISTEN_HTTPS=:7612
  export NTFY_LISTEN_HTTP=""
  export NTFY_CERT_FILE="${certfile}"
  export NTFY_KEY_FILE="${keyfile}"
else
  export NTFY_LISTEN_HTTP=:7612
fi

# export NTFY_BEHIND_PROXY=true
# export NTFY_WEB_ROOT=disable

bashio::log.info uname info: $(uname -a)

bashio::log.info Starting ntfy
bashio::log.info $(/usr/bin/ntfy serve)

## Run your program
exec /usr/bin/ntfy serve
